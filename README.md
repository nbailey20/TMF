# Trusty Music Fabricator (TMF)
Generate a Spotify playlist based on your current music interests by texting a Twilio-owned phone number.
Easy AWS-based serverless deployment that is completely pay-as-you-use (besides Spotify account and Twilio number, see their free trial).

## Setup Instructions
1. Create terraform.tfvars file with information needed in variables.tf - AWS account, spotify account, Twilio number, etc
2. Run setup.sh script to build app in AWS and update Twilio phone number webhook URL
3. Text your Trusty Music Fabricator to say hi, and enjoy :)  - expect a few mins delay to keep AWS cost at a minimum
4. Terraform destroy to get rid of everything in AWS if you want to 'uninstall', don't forget to release Twilio number!

## Current Version: 0.3.0
Deployment into AWS and integration with Twilio webhook is working. Initial playlist is created with name "Trusty Music Fabricator" with correct number of songs, however reported failures after several generations.

## Usage Instructions
- In general, texting anything will refresh the TMF playlist
- Refreshing means - adding enough new songs to the playlist to reach the desired number, and replacing any 'neutral' songs that have been listened to a variable number of times (neutral_song_refresh_rate).
- Songs will be generated by randomly combining 1-3 songs in a user's Spotify current top tracks as seeds for a new song generation

## Known Bugs / Issues / Needs
- [RESOLVED] Network connectivity sometimes not working when app is invoked due to CloudFormation stack finishing NATGW->IGW resource and route creation immediately beforehand, adding network connectivity test to check and wait a few seconds before trying again
- TMF doesn't immediately respond with warmup message - Hypothesis: API resource creation in TF is sometimes out of order enough to block Lambda response to text, APIGW returns 500
    Reinstalling app usually fixes, update to use trigger for APIGW TF instead of depends per AWS docs
- Spotify occasionally doesn't want to provide new refresh token which causes error in app - hypothesis: token expiration related, too many frequent texts?
- [RESOLVED] Songbank keeps track of / increments play count for songs even when user removed them, has no effect on usage but still
- TMF can fail when writing new songbank back to S3, put object call is timing out - need network connectivity check for all S3 operations
- TMF silently fails when texted during network stack deletion - no issue if warmup message works
- TMF ignores existing Spotify playlists with same name upon app setup, will create new playlist instead of choosing existing (should be variable option to overwrite)
- [RESOLVED] Update setup script to invoke Twilio API to update phone number instead of manually copy/pasting with MFA login
- Need ability to specify number of songs via Hello text to TMF - how to go from larger to smaller?
- Need ability to specify that all songs are replaced via Hello text - reset keyword?
- Need ability to loosely control playlist via Hello text - specific keyword to include in search query
- Need ability to accidentally delete spotify playlist and resume without having to recreate songbank